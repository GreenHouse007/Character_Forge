import { CharacterClass } from '@/types/class';

export const magus: CharacterClass = {
  name: 'Magus',
  source: 'UM',
  description: 'A warrior-mage who blends martial prowess with arcane magic, channeling spells through weapon strikes.',
  hitDie: 8,
  babProgression: 'threeQuarter',
  goodSaves: ['fortitude', 'will'],
  skillRanksPerLevel: 2,
  classSkills: [
    'Climb', 'Craft', 'Fly', 'Intimidate', 'Knowledge (Arcana)',
    'Knowledge (Dungeoneering)', 'Knowledge (Planes)', 'Profession',
    'Ride', 'Spellcraft', 'Swim', 'Use Magic Device',
  ],
  classFeatures: [
    { name: 'Arcane Pool', level: 1, description: 'Pool of arcane points equal to 1/2 magus level + Intelligence modifier. Spend points to enhance weapons with +1 bonus (and special abilities at higher levels) as a swift action for 1 minute.' },
    { name: 'Cantrips', level: 1, description: 'Prepare and cast 0-level spells.' },
    { name: 'Spell Combat', level: 1, description: 'As a full-round action, make all melee attacks and also cast a magus spell with a -2 penalty on attack rolls.' },
    { name: 'Spellstrike', level: 2, description: 'Deliver touch spells through weapon attacks as part of a melee attack.' },
    { name: 'Magus Arcana', level: 3, description: 'Select a magus arcana at 3rd level and every 3 levels thereafter.' },
    { name: 'Spell Recall', level: 4, description: 'Spend arcane pool points equal to spell level to recall a spent prepared spell.' },
    { name: 'Bonus Feat', level: 5, description: 'Gain a bonus combat or metamagic feat at 5th level and every 6 levels thereafter.' },
    { name: 'Knowledge Pool', level: 7, description: 'Spend 1 arcane pool point to prepare any spell from the magus spell list that is not in your spellbook.' },
    { name: 'Improved Spell Combat', level: 8, description: 'Spell Combat attack penalty reduced to -1. At 14th level, no penalty.' },
    { name: 'Fighter Training', level: 10, description: 'Treat magus level as fighter level for feat prerequisites.' },
    { name: 'Improved Spell Recall', level: 11, description: 'Spend arcane pool to recall spells as a swift action.' },
    { name: 'Counterstrike', level: 16, description: 'Make an attack of opportunity against anyone who casts defensively in your threatened area and fails.' },
    { name: 'True Magus', level: 20, description: 'Spell Combat with no penalty. Can make attacks of opportunity while casting in melee.' },
  ],
  spellProgression: {
    type: 'prepared',
    castingAbility: 'int',
    maxSpellLevel: 6,
    spellsPerDay: {
      1:  { 0: 3, 1: 1 },
      2:  { 0: 4, 1: 2 },
      3:  { 0: 4, 1: 3 },
      4:  { 0: 4, 1: 3, 2: 1 },
      5:  { 0: 4, 1: 4, 2: 2 },
      6:  { 0: 5, 1: 4, 2: 3 },
      7:  { 0: 5, 1: 4, 2: 3, 3: 1 },
      8:  { 0: 5, 1: 4, 2: 4, 3: 2 },
      9:  { 0: 5, 1: 5, 2: 4, 3: 3 },
      10: { 0: 5, 1: 5, 2: 4, 3: 3, 4: 1 },
      11: { 0: 5, 1: 5, 2: 4, 3: 4, 4: 2 },
      12: { 0: 6, 1: 5, 2: 5, 3: 4, 4: 3 },
      13: { 0: 6, 1: 5, 2: 5, 3: 4, 4: 3, 5: 1 },
      14: { 0: 6, 1: 5, 2: 5, 3: 4, 4: 4, 5: 2 },
      15: { 0: 6, 1: 5, 2: 5, 3: 5, 4: 4, 5: 3 },
      16: { 0: 6, 1: 5, 2: 5, 3: 5, 4: 4, 5: 3, 6: 1 },
      17: { 0: 6, 1: 5, 2: 5, 3: 5, 4: 4, 5: 4, 6: 2 },
      18: { 0: 6, 1: 5, 2: 5, 3: 5, 4: 5, 5: 4, 6: 3 },
      19: { 0: 6, 1: 5, 2: 5, 3: 5, 4: 5, 5: 5, 6: 4 },
      20: { 0: 6, 1: 5, 2: 5, 3: 5, 4: 5, 5: 5, 6: 5 },
    },
  },
  classResources: [
    {
      name: 'Arcane Pool',
      description: 'Pool of arcane energy for weapon enhancement and magus arcana.',
      getUsesAtLevel: (level, intMod?) => Math.floor(level / 2) + (intMod ?? 0),
      resetsOn: 'rest',
    },
  ],
  bonusFeats: [
    { level: 5, note: 'Combat or Metamagic feat' },
    { level: 11, note: 'Combat or Metamagic feat' },
    { level: 17, note: 'Combat or Metamagic feat' },
  ],
  startingWealth: { dice: { count: 4, sides: 6 }, multiplier: 10, average: 140 },
  proficiencies: {
    weapons: ['simple weapons', 'martial weapons'],
    armor: ['light armor'],
    shields: [],
  },
};
